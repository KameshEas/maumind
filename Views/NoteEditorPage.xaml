<?xml version="1.0" encoding="UTF-8"?>
<ContentPage
    x:Class="MauMind.App.Views.NoteEditorPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Note Editor"
    Background="{AppThemeBinding Light={StaticResource LightBackground}, Dark={StaticResource DarkBackground}}">

    <Grid RowDefinitions="Auto,*,Auto,Auto">
        <!-- Premium Header Toolbar -->
        <Grid Grid.Row="0" Margin="16,12" HeightRequest="48">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Back Button -->
            <Button Grid.Column="0" Text="&#x2190;" FontSize="18"
                    BackgroundColor="Transparent" TextColor="{StaticResource Primary}"
                    Command="{Binding CancelCommand}"/>

            <!-- Status -->
            <Label Grid.Column="1" Text="{Binding StatusMessage}" FontSize="13"
                   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                   HorizontalOptions="Center" VerticalOptions="Center"/>

            <!-- Save Button -->
            <Button Grid.Column="2" Text="Save" FontSize="15" FontAttributes="Bold"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding SaveCommand}"/>
        </Grid>

        <!-- Editor Area -->
        <ScrollView Grid.Row="1" Padding="16,0">
            <StackLayout Spacing="16">
                <!-- Title Entry -->
                <Entry Placeholder="Note title..." 
                       Text="{Binding Title}"
                       FontSize="22" FontAttributes="Bold"
                       BackgroundColor="Transparent"
                       TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                       PlaceholderColor="{AppThemeBinding Light={StaticResource LightTextTertiary}, Dark={StaticResource DarkTextTertiary}}"/>

                <!-- Content Editor -->
                <Editor x:Name="ContentEditor"
                        Placeholder="Start writing..."
                        Text="{Binding Content}"
                        FontSize="16"
                        AutoSize="TextChanges"
                        MinimumHeightRequest="300"
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                        PlaceholderColor="{AppThemeBinding Light={StaticResource LightTextTertiary}, Dark={StaticResource DarkTextTertiary}}"/>

                <!-- Suggestions Section -->
                <StackLayout x:Name="SuggestionsSection" Spacing="12" IsVisible="{Binding HasSuggestions}">
                    <Label Text="Writing Suggestions" FontSize="14" FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"/>

                    <StackLayout x:Name="SuggestionsStack" Spacing="8" BindableLayout.ItemsSource="{Binding Suggestions}">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="12" Padding="14,10"
                                       BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
                                       HasShadow="False">
                                    <StackLayout Spacing="8">
                                        <!-- Suggestion Type Badge -->
                                        <Label Text="{Binding Type}" FontSize="10" FontAttributes="Bold"
                                               TextColor="{StaticResource Accent}" HorizontalOptions="Start"/>

                                        <!-- Original text -->
                                        <Label Text="{Binding OriginalText}" FontSize="13" TextColor="{StaticResource Error}"/>

                                        <!-- Arrow -->
                                        <Label Text="&#x2192;" FontSize="12" TextColor="{StaticResource Success}"/>

                                        <!-- Suggested text -->
                                        <Label Text="{Binding SuggestedText}" FontSize="14" TextColor="{StaticResource Success}" FontAttributes="Bold"/>

                                        <!-- Explanation -->
                                        <Label Text="{Binding Explanation}" FontSize="12" 
                                               TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>

                                        <!-- Action Buttons -->
                                        <StackLayout Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                            <Button Text="Accept" FontSize="12" FontAttributes="Bold"
                                                    BackgroundColor="{StaticResource Success}"
                                                    TextColor="White" CornerRadius="8"
                                                    Clicked="OnAcceptSuggestion"/>
                                            <Button Text="Ignore" FontSize="12"
                                                    BackgroundColor="Transparent"
                                                    TextColor="{StaticResource Gray500}"
                                                    CornerRadius="8"
                                                    Clicked="OnIgnoreSuggestion"/>
                                        </StackLayout>
                                    </StackLayout>
                                </Frame>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </StackLayout>
                </StackLayout>
            </StackLayout>
        </ScrollView>

        <!-- Writing Tools -->
        <Grid Grid.Row="2" Margin="16,8" HeightRequest="48">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Tone Selector -->
            <Picker Grid.Column="0" 
                    Title="Tone"
                    ItemsSource="{Binding ToneOptions}"
                    SelectedItem="{Binding SelectedTone}"
                    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                    HorizontalOptions="Fill"/>

            <!-- Rewrite Button -->
            <Button Grid.Column="1" Text="Rewrite" FontSize="13"
                    BackgroundColor="Transparent" TextColor="{StaticResource Accent}"
                    Command="{Binding RewriteCommand}"
                    Margin="8,0,0,0"/>

            <!-- Analyze Button -->
            <Button Grid.Column="2" Text="Analyze" FontSize="13" FontAttributes="Bold"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding AnalyzeCommand}"
                    Margin="8,0,0,0"/>
        </Grid>

        <!-- Loading Overlay -->
        <Frame Grid.RowSpan="4" 
               x:Name="LoadingOverlay"
               IsVisible="{Binding IsAnalyzing}"
               BackgroundColor="#CC000000"
               HasShadow="False"
               VerticalOptions="Fill" HorizontalOptions="Fill">
            <StackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="16">
                <ActivityIndicator IsRunning="{Binding IsAnalyzing}" Color="White" WidthRequest="32" HeightRequest="32"/>
                <Label Text="Analyzing..." FontSize="15"
                       TextColor="White"/>
            </StackLayout>
        </Frame>
    </Grid>

</ContentPage>
