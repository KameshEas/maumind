<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage
    x:Class="MauMind.App.Views.DocumentsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Documents"
    Background="{AppThemeBinding Light={StaticResource BackgroundGradientLight}, Dark={StaticResource DarkBackground}}">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Premium Header -->
        <Frame Grid.Row="0" Margin="16,16,16,8" CornerRadius="20" Padding="16,12"
               Background="{AppThemeBinding Light={StaticResource LightSurfaceGlass}, Dark={StaticResource DarkSurfaceGlass}}"
               HasShadow="True">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Back Button (visible when in folder) -->
                <Button Grid.Column="0" Text="â†" FontSize="18" 
                        BackgroundColor="Transparent" TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                        WidthRequest="36" HeightRequest="36" Padding="0"
                        IsVisible="{Binding CurrentFolder, Converter={StaticResource NotNullConverter}}"
                        Command="{Binding ShowAllDocumentsCommand}"/>
                
                <!-- Icon -->
                <Frame Grid.Column="0" WidthRequest="44" HeightRequest="44" CornerRadius="22"
                       Background="{StaticResource AccentPurple}" Padding="0"
                       IsVisible="{Binding CurrentFolder, Converter={StaticResource IsNullConverter}}">
                    <Label Text="ðŸ“„" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center"/>
                </Frame>
                
                <!-- Title & Path -->
                <StackLayout Grid.Column="1" VerticalOptions="Center" Margin="12,0">
                    <Label Text="{Binding CurrentFolderPath}" FontSize="17" FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"/>
                    <Label Text="{Binding DocumentCount, StringFormat='{0} documents'}" FontSize="12"
                           TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                </StackLayout>

                <!-- New Folder Button -->
                <Button Grid.Column="2" Text="+ ðŸ“" FontSize="14"
                        BackgroundColor="Transparent" TextColor="{StaticResource AccentPurple}"
                        WidthRequest="44" HeightRequest="44" Padding="0"
                        Clicked="OnNewFolderClicked"/>
            </Grid>
        </Frame>

        <!-- Main Content -->
        <ScrollView Grid.Row="1" VerticalScrollBarVisibility="Always" Padding="16,8">
            <StackLayout x:Name="MainContentStack" Spacing="12">
                <!-- Folders Section (visible at root) -->
                <StackLayout x:Name="FoldersSection" Spacing="8" 
                             IsVisible="{Binding CurrentFolder, Converter={StaticResource IsNullConverter}}">
                    <Label Text="Folders" FontSize="14" FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                           Margin="4,0"/>

                    <!-- Folders List -->
                    <StackLayout x:Name="FoldersStack" Spacing="8"/>

                    <!-- Uncategorized -->
                    <Frame x:Name="UncategorizedCard" CornerRadius="12" Padding="12,10"
                           BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2A2A2A}"
                           HasShadow="False" Margin="0,4">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnUncategorizedTapped"/>
                        </Frame.GestureRecognizers>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Text="ðŸ“„" FontSize="20" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Text="Uncategorized" FontSize="15" VerticalOptions="Center"
                                   TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                                   Margin="12,0,0,0"/>
                            <Label Grid.Column="2" Text="{Binding UncategorizedCount, StringFormat='({0})'}"
                                   FontSize="12" VerticalOptions="Center"
                                   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                        </Grid>
                    </Frame>
                </StackLayout>

                <!-- Separator -->
                <BoxView x:Name="FolderSeparator" HeightRequest="1" 
                         Color="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                         IsVisible="{Binding CurrentFolder, Converter={StaticResource IsNullConverter}}"
                         Margin="0,8"/>

                <!-- Documents Section -->
                <StackLayout x:Name="DocumentsSection" Spacing="8">
                    <Label Text="Documents" FontSize="14" FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                           Margin="4,0"/>

                    <StackLayout x:Name="DocumentsStack" Spacing="12">
                        <!-- Empty State -->
                        <StackLayout x:Name="DocumentsEmptyState" 
                                     VerticalOptions="Center" 
                                     HorizontalOptions="Center" 
                                     Margin="20,60,20,20"
                                     Spacing="16">
                            <StackLayout HorizontalOptions="Center">
                                <!-- Premium Icon -->
                                <Frame WidthRequest="100" HeightRequest="100" CornerRadius="50"
                                       Background="{AppThemeBinding Light=#F3E5F5, Dark=#2D1B4E}"
                                       HorizontalOptions="Center" Padding="0">
                                    <Label Text="ðŸ“‘" FontSize="42" HorizontalOptions="Center" VerticalOptions="Center"/>
                                </Frame>
                                
                                <Label Text="No Documents Yet" 
                                       FontSize="22" FontAttributes="Bold" 
                                       TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                                       HorizontalOptions="Center" Margin="0,16,0,8"/>
                                
                                <Label Text="Add notes, journals, or import PDFs to build your knowledge base" 
                                       FontSize="14" 
                                       TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                                       HorizontalOptions="Center" 
                                       HorizontalTextAlignment="Center"
                                       Margin="0,0,0,20"/>
                                
                                <!-- Add Buttons -->
                                <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="12">
                                    <Button Text="+ Note" 
                                            Style="{StaticResource PrimaryButton}"
                                            Clicked="OnAddNoteClicked"/>
                                    <Button Text="+ PDF" 
                                            Style="{StaticResource SecondaryButton}"
                                            Clicked="OnAddPdfClicked"/>
                                </StackLayout>
                            </StackLayout>
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </StackLayout>
        </ScrollView>

        <!-- Premium FAB for Adding -->
        <Grid Grid.Row="2" Margin="16,8,16,20">
            <Button Text="+ Add Document" 
                    Style="{StaticResource PrimaryButton}"
                    HorizontalOptions="Center"
                    Clicked="OnAddDocumentClicked"/>
        </Grid>
    </Grid>

</ContentPage>